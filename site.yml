---
- name: Complete Server Setup
  hosts: all
  gather_facts: true
  vars:
    ansible_user: "{{ survey_ansible_user }}"
    ansible_port: "{{ survey_ansible_port }}"

  pre_tasks:
    - name: Identify Linux distribution
      set_fact:
        linux_distribution: "{{ ansible_facts['distribution'] | lower }}"
    - name: Print Linux distribution
      debug:
        msg: "This system is running {{ linux_distribution }}"

  roles:
    - user_setup
    - role: common
      become: true
      remote_user: exadmn
    - role: opsview
      become: true
      become_user: exadmn
    - role: security
      become: true
      become_user: exadmn
